# 性能计数器数据采集脚本

本目录包含用于采集硬件性能计数器数据的Shell脚本，采用两种不同的采样策略。

## 脚本说明

### 非时分复用(Non-TDM)脚本

这些脚本采用非时分复用的方式采集性能计数器数据：

- `Non_TDM_10s.sh`: 10秒采样周期
- `Non_TDM_20s.sh`: 20秒采样周期  
- `Non_TDM_30s.sh`: 30秒采样周期

主要特点:
- 每4个性能计数器事件为一组进行采集
- 需要多次运行样本以获取所有事件数据
- 采样开销较小，但需要多次执行

### 时分复用(TDM)脚本

这些脚本采用时分复用的方式采集性能计数器数据：

- `TDM_10s.sh`: 10秒采样周期
- `TDM_20s.sh`: 20秒采样周期
- `TDM_30s.sh`: 30秒采样周期

主要特点:
- 同时采集所有20个性能计数器事件
- 每个样本包含完整的性能计数器数据
- 采样开销较大，但只需执行一次

## 共同功能

所有脚本都具有以下功能:

- 使用Docker容器隔离运行环境
- 支持恶意软件和良性软件的性能数据采集
- 提供4种不同的采样模式:
  1. 完整时长持续采样(10s/20s/30s)
  2. 短时间采样重复5次(2s/4s/6s)
  3. 100ms间隔采样
  4. 10ms间隔采样

## 性能计数器事件

脚本采集20种硬件性能计数器事件，包括：
- 分支指令相关(branch-instructions, branch-misses等)
- 缓存访问相关(cache-misses, cache-references等) 
- CPU周期相关(cpu-cycles, ref-cycles等)
- 内存访问相关(L1-dcache-loads, LLC-loads等)
- TLB相关(dTLB-loads, iTLB-load-misses等)

详细的事件列表请参考 `HPC_EVENTS.csv`。

## 使用方法

1. 确保系统已安装Docker和perf工具

2. 构建基础Docker镜像: